<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="NYC Restaurants">
    <title>NYC Restaurant Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: #f9fafb;
            -webkit-font-smoothing: antialiased;
        }
        
        .header {
            background-color: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .header-content {
            max-width: 896px;
            margin: 0 auto;
            padding: 16px;
        }
        
        .header-top {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }
        
        .header-top h1 {
            font-size: 24px;
            font-weight: bold;
            color: #111827;
        }
        
        .header-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .btn-add {
            background-color: #3b82f6;
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            border: none;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            white-space: nowrap;
        }
        
        .btn-menu {
            background: none;
            border: none;
            color: #6b7280;
            font-size: 24px;
            cursor: pointer;
            padding: 4px 8px;
        }
        
        .menu-dropdown {
            position: absolute;
            top: 50px;
            right: 16px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 100;
            min-width: 200px;
        }
        
        .menu-item {
            padding: 12px 16px;
            border-bottom: 1px solid #f3f4f6;
            cursor: pointer;
            font-size: 14px;
            color: #111827;
        }
        
        .menu-item:last-child {
            border-bottom: none;
        }
        
        .menu-item:hover {
            background-color: #f9fafb;
        }
        
        .filters {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }
        
        .filters select {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .content {
            max-width: 896px;
            margin: 0 auto;
            padding: 24px 16px 100px 16px;
        }
        
        .restaurant-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            padding: 16px;
            margin-bottom: 12px;
        }
        
        .restaurant-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }
        
        .restaurant-name {
            font-size: 18px;
            font-weight: 600;
            color: #111827;
            margin-bottom: 4px;
        }
        
        .badge-visited {
            display: inline-block;
            background-color: #d1fae5;
            color: #065f46;
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 4px;
            margin-left: 8px;
        }
        
        .stars {
            display: flex;
            gap: 4px;
            margin-bottom: 8px;
        }
        
        .star {
            width: 16px;
            height: 16px;
        }
        
        .restaurant-details {
            font-size: 14px;
            color: #4b5563;
        }
        
        .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 8px;
        }
        
        .tag {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .tag-neighborhood {
            background-color: #f3f4f6;
        }
        
        .tag-cuisine {
            background-color: #dbeafe;
            color: #1e40af;
        }
        
        .actions {
            display: flex;
            gap: 8px;
        }
        
        .btn-icon {
            background: none;
            border: none;
            color: #9ca3af;
            cursor: pointer;
            padding: 4px;
        }
        
        .form-page {
            min-height: 100vh;
            background-color: #f9fafb;
            padding-bottom: 80px;
        }
        
        .form-header {
            background-color: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .form-header-content {
            max-width: 896px;
            margin: 0 auto;
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .btn-back {
            background: none;
            border: none;
            color: #4b5563;
            cursor: pointer;
            padding: 8px;
            font-size: 24px;
        }
        
        .form-content {
            max-width: 896px;
            margin: 0 auto;
            padding: 24px 16px;
        }
        
        .form-group {
            margin-bottom: 24px;
        }
        
        .form-label {
            display: block;
            font-size: 16px;
            font-weight: 500;
            color: #111827;
            margin-bottom: 8px;
        }
        
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-family: inherit;
        }
        
        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .rating-stars {
            display: flex;
            gap: 12px;
        }
        
        .rating-star {
            background: none;
            border: none;
            cursor: pointer;
            padding: 4px;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .checkbox-input {
            width: 20px;
            height: 20px;
        }
        
        .fixed-button {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: white;
            padding: 16px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 20;
        }
        
        .btn-save {
            width: 100%;
            background-color: #3b82f6;
            color: white;
            padding: 16px;
            font-size: 18px;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
        
        .btn-save:active {
            background-color: #2563eb;
        }
        
        .empty-state {
            text-align: center;
            padding: 48px 16px;
            color: #6b7280;
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <!-- Main List View -->
    <div id="listView">
        <div class="header">
            <div class="header-content">
                <div class="header-top">
                    <h1>NYC Restaurants</h1>
                    <div class="header-actions">
                        <button class="btn-add" onclick="showForm()">+ Add</button>
                        <button class="btn-menu" onclick="toggleMenu()">‚ãÆ</button>
                    </div>
                </div>
                <div id="menuDropdown" class="menu-dropdown hidden">
                    <div class="menu-item" onclick="exportData()">üì• Export Data</div>
                    <div class="menu-item" onclick="document.getElementById('importFile').click()">üì§ Import Data</div>
                </div>
                <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)">
                <div style="margin-bottom: 12px;">
                    <input 
                        type="text" 
                        id="searchBox" 
                        class="form-input" 
                        placeholder="Search restaurants..." 
                        oninput="filterRestaurants()"
                        style="margin-bottom: 0;"
                    >
                </div>
                <div class="filters">
                    <select id="filterNeighborhood" onchange="filterRestaurants()">
                        <option value="">All Neighborhoods</option>
                    </select>
                    <select id="filterCuisine" onchange="filterRestaurants()">
                        <option value="">All Cuisines</option>
                    </select>
                    <select id="filterVisited" onchange="filterRestaurants()">
                        <option value="all">All Restaurants</option>
                        <option value="visited">Visited</option>
                        <option value="notVisited">Not Visited</option>
                    </select>
                    <select id="sortBy" onchange="filterRestaurants()">
                        <option value="rating">Sort by Rating</option>
                        <option value="name">Sort by Name</option>
                        <option value="neighborhood">Sort by Location</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="content" id="restaurantList"></div>
    </div>

    <!-- Form View -->
    <div id="formView" class="form-page hidden">
        <div class="form-header">
            <div class="form-header-content">
                <button class="btn-back" onclick="hideForm()">‚Üê</button>
                <h1 id="formTitle">Add Restaurant</h1>
            </div>
        </div>
        <div class="form-content">
            <div class="form-group">
                <label class="form-label">Restaurant Name *</label>
                <input type="text" id="inputName" class="form-input" placeholder="e.g., Carbone">
            </div>
            
            <div class="form-group">
                <label class="form-label">Neighborhood *</label>
                <select id="inputNeighborhood" class="form-select">
                    <option value="">Select neighborhood...</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label">Cuisine</label>
                <select id="inputCuisine" class="form-select">
                    <option value="">Select cuisine...</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label">Your Rating</label>
                <div class="rating-stars" id="ratingStars"></div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Address</label>
                <input type="text" id="inputAddress" class="form-input" placeholder="e.g., 181 Thompson St">
            </div>
            
            <div class="form-group">
                <label class="form-label">Source (Who told you about it?)</label>
                <input type="text" id="inputSource" class="form-input" placeholder="e.g., Sarah">
            </div>
            
            <div class="form-group">
                <label class="form-label">Notes</label>
                <textarea id="inputNotes" class="form-textarea" placeholder="Must-try dishes, people who work there, etc."></textarea>
            </div>
            
            <div class="form-group">
                <div class="checkbox-group">
                    <input type="checkbox" id="inputVisited" class="checkbox-input">
                    <label for="inputVisited" class="form-label" style="margin-bottom: 0;">I've visited this restaurant</label>
                </div>
            </div>
        </div>
        
        <div class="fixed-button">
            <button class="btn-save" onclick="saveRestaurant()">Add Restaurant</button>
        </div>
    </div>

    <script>
        const neighborhoods = [
            'Upper East Side', 'Upper West Side', 'Midtown East', 'Midtown West',
            'Chelsea', 'Greenwich Village', 'West Village', 'East Village',
            'SoHo', 'Tribeca', 'Lower East Side', 'Financial District',
            'Gramercy', 'Murray Hill', 'Hell\'s Kitchen', 'Flatiron',
            'NoMad', 'NoLita', 'Chinatown', 'Little Italy',
            'Williamsburg', 'Brooklyn Heights', 'Park Slope', 'DUMBO',
            'Astoria', 'Long Island City', 'Flushing', 'Other'
        ];

        const cuisines = [
            'American', 'Italian', 'French', 'Japanese', 'Chinese',
            'Mexican', 'Thai', 'Indian', 'Mediterranean', 'Greek',
            'Korean', 'Vietnamese', 'Spanish', 'Middle Eastern',
            'Steakhouse', 'Seafood', 'Pizza', 'Sushi', 'Ramen',
            'Bakery', 'Cafe', 'Bar/Cocktails', 'Fusion', 'Other'
        ];

        let restaurants = [];
        let editingId = null;
        let currentRating = 0;

        // Initialize
        function init() {
            loadRestaurants();
            populateDropdowns();
            createRatingStars();
        }

        function populateDropdowns() {
            const neighborhoodSelect = document.getElementById('inputNeighborhood');
            neighborhoods.forEach(n => {
                const option = document.createElement('option');
                option.value = n;
                option.textContent = n;
                neighborhoodSelect.appendChild(option);
            });

            const cuisineSelect = document.getElementById('inputCuisine');
            cuisines.forEach(c => {
                const option = document.createElement('option');
                option.value = c;
                option.textContent = c;
                cuisineSelect.appendChild(option);
            });
        }

        function createRatingStars() {
            const container = document.getElementById('ratingStars');
            for (let i = 1; i <= 5; i++) {
                const btn = document.createElement('button');
                btn.className = 'rating-star';
                btn.onclick = () => setRating(i);
                btn.innerHTML = createStarSVG(false);
                btn.dataset.star = i;
                container.appendChild(btn);
            }
        }

        function setRating(rating) {
            currentRating = rating;
            updateRatingDisplay();
        }

        function updateRatingDisplay() {
            const stars = document.querySelectorAll('.rating-star');
            stars.forEach((star, index) => {
                const filled = (index + 1) <= currentRating;
                star.innerHTML = createStarSVG(filled);
            });
        }

        function createStarSVG(filled) {
            return `<svg width="40" height="40" viewBox="0 0 24 24" fill="${filled ? '#fbbf24' : 'none'}" stroke="${filled ? '#fbbf24' : '#d1d5db'}" stroke-width="2">
                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
            </svg>`;
        }

        function loadRestaurants() {
            const stored = localStorage.getItem('nycRestaurants');
            restaurants = stored ? JSON.parse(stored) : [];
            renderRestaurants();
            updateFilterOptions();
        }

        function saveToStorage() {
            localStorage.setItem('nycRestaurants', JSON.stringify(restaurants));
        }

        function showForm(restaurant = null) {
            editingId = restaurant ? restaurant.id : null;
            
            if (restaurant) {
                document.getElementById('formTitle').textContent = 'Edit Restaurant';
                document.getElementById('inputName').value = restaurant.name;
                document.getElementById('inputNeighborhood').value = restaurant.neighborhood;
                document.getElementById('inputCuisine').value = restaurant.cuisine || '';
                currentRating = restaurant.rating || 0;
                document.getElementById('inputAddress').value = restaurant.address || '';
                document.getElementById('inputSource').value = restaurant.source || '';
                document.getElementById('inputNotes').value = restaurant.notes || '';
                document.getElementById('inputVisited').checked = restaurant.visited || false;
                document.querySelector('.btn-save').textContent = 'Update Restaurant';
            } else {
                document.getElementById('formTitle').textContent = 'Add Restaurant';
                document.getElementById('inputName').value = '';
                document.getElementById('inputNeighborhood').value = '';
                document.getElementById('inputCuisine').value = '';
                currentRating = 0;
                document.getElementById('inputAddress').value = '';
                document.getElementById('inputSource').value = '';
                document.getElementById('inputNotes').value = '';
                document.getElementById('inputVisited').checked = false;
                document.querySelector('.btn-save').textContent = 'Add Restaurant';
            }
            
            updateRatingDisplay();
            document.getElementById('listView').classList.add('hidden');
            document.getElementById('formView').classList.remove('hidden');
            window.scrollTo(0, 0);
        }

        function hideForm() {
            document.getElementById('formView').classList.add('hidden');
            document.getElementById('listView').classList.remove('hidden');
            editingId = null;
        }

        function saveRestaurant() {
            const name = document.getElementById('inputName').value.trim();
            const neighborhood = document.getElementById('inputNeighborhood').value;
            
            if (!name || !neighborhood) {
                alert('Please fill in restaurant name and neighborhood');
                return;
            }

            const restaurant = {
                id: editingId || Date.now().toString(),
                name,
                neighborhood,
                cuisine: document.getElementById('inputCuisine').value,
                rating: currentRating,
                address: document.getElementById('inputAddress').value.trim(),
                source: document.getElementById('inputSource').value.trim(),
                notes: document.getElementById('inputNotes').value.trim(),
                visited: document.getElementById('inputVisited').checked
            };

            if (editingId) {
                const index = restaurants.findIndex(r => r.id === editingId);
                restaurants[index] = restaurant;
            } else {
                restaurants.push(restaurant);
            }

            saveToStorage();
            hideForm();
            loadRestaurants();
        }

        function deleteRestaurant(id) {
            if (confirm('Are you sure you want to delete this restaurant?')) {
                restaurants = restaurants.filter(r => r.id !== id);
                saveToStorage();
                renderRestaurants();
                updateFilterOptions();
            }
        }

        function filterRestaurants() {
            const searchTerm = document.getElementById('searchBox').value.toLowerCase();
            const neighborhoodFilter = document.getElementById('filterNeighborhood').value;
            const cuisineFilter = document.getElementById('filterCuisine').value;
            const visitedFilter = document.getElementById('filterVisited').value;
            const sortBy = document.getElementById('sortBy').value;

            let filtered = restaurants.filter(r => {
                // Search filter
                if (searchTerm) {
                    const nameMatch = r.name.toLowerCase().includes(searchTerm);
                    const notesMatch = r.notes && r.notes.toLowerCase().includes(searchTerm);
                    const sourceMatch = r.source && r.source.toLowerCase().includes(searchTerm);
                    if (!nameMatch && !notesMatch && !sourceMatch) return false;
                }
                
                if (neighborhoodFilter && r.neighborhood !== neighborhoodFilter) return false;
                if (cuisineFilter && r.cuisine !== cuisineFilter) return false;
                if (visitedFilter === 'visited' && !r.visited) return false;
                if (visitedFilter === 'notVisited' && r.visited) return false;
                return true;
            });

            filtered.sort((a, b) => {
                if (sortBy === 'rating') return (b.rating || 0) - (a.rating || 0);
                if (sortBy === 'name') return a.name.localeCompare(b.name);
                if (sortBy === 'neighborhood') return a.neighborhood.localeCompare(b.neighborhood);
                return 0;
            });

            renderRestaurants(filtered);
        }

        function updateFilterOptions() {
            const neighborhoodSet = new Set(restaurants.map(r => r.neighborhood));
            const cuisineSet = new Set(restaurants.map(r => r.cuisine).filter(c => c));

            const neighborhoodFilter = document.getElementById('filterNeighborhood');
            neighborhoodFilter.innerHTML = '<option value="">All Neighborhoods</option>';
            Array.from(neighborhoodSet).sort().forEach(n => {
                const option = document.createElement('option');
                option.value = n;
                option.textContent = n;
                neighborhoodFilter.appendChild(option);
            });

            const cuisineFilter = document.getElementById('filterCuisine');
            cuisineFilter.innerHTML = '<option value="">All Cuisines</option>';
            Array.from(cuisineSet).sort().forEach(c => {
                const option = document.createElement('option');
                option.value = c;
                option.textContent = c;
                cuisineFilter.appendChild(option);
            });
        }

        function renderRestaurants(list = restaurants) {
            const container = document.getElementById('restaurantList');
            
            if (list.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <p style="font-size: 18px; margin-bottom: 16px;">
                            ${restaurants.length === 0 ? 'No restaurants yet!' : 'No restaurants match your filters.'}
                        </p>
                        ${restaurants.length === 0 ? '<button onclick="showForm()" style="color: #3b82f6; background: none; border: none; font-size: 16px; font-weight: 500; cursor: pointer;">Add your first restaurant</button>' : ''}
                    </div>
                `;
                return;
            }

            container.innerHTML = list.map(restaurant => `
                <div class="restaurant-card">
                    <div class="restaurant-header">
                        <div style="flex: 1;">
                            <div class="restaurant-name">
                                ${restaurant.name}
                                ${restaurant.visited ? '<span class="badge-visited">Visited</span>' : ''}
                            </div>
                            <div class="stars">
                                ${[1,2,3,4,5].map(i => `
                                    <svg class="star" viewBox="0 0 24 24" fill="${i <= restaurant.rating ? '#fbbf24' : 'none'}" stroke="${i <= restaurant.rating ? '#fbbf24' : '#d1d5db'}" stroke-width="2">
                                        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                                    </svg>
                                `).join('')}
                            </div>
                            <div class="restaurant-details">
                                <div class="tags">
                                    <span class="tag tag-neighborhood">${restaurant.neighborhood}</span>
                                    ${restaurant.cuisine ? `<span class="tag tag-cuisine">${restaurant.cuisine}</span>` : ''}
                                </div>
                                ${restaurant.source ? `<p style="margin: 4px 0;"><strong>Source:</strong> ${restaurant.source}</p>` : ''}
                                ${restaurant.notes ? `<p style="margin: 4px 0;"><strong>Notes:</strong> ${restaurant.notes}</p>` : ''}
                                ${restaurant.address ? `
                                    <button onclick="openInMaps('${restaurant.address}', '${restaurant.name}')" style="display: flex; align-items: center; gap: 4px; color: #3b82f6; background: none; border: none; padding: 4px 0; margin-top: 4px; cursor: pointer; font-size: 14px;">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                            <circle cx="12" cy="10" r="3"></circle>
                                        </svg>
                                        ${restaurant.address}
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                        <div class="actions">
                            <button class="btn-icon" onclick='showForm(${JSON.stringify(restaurant).replace(/'/g, "&#39;")})'>
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                </svg>
                            </button>
                            <button class="btn-icon" onclick="deleteRestaurant('${restaurant.id}')">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="18" y1="6" x2="6" y2="18"></line>
                                    <line x1="6" y1="6" x2="18" y2="18"></line>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function openInMaps(address, name) {
            const query = encodeURIComponent(`${name}, ${address}, New York, NY`);
            window.open(`https://maps.google.com/?q=${query}`, '_blank');
        }

        function toggleMenu() {
            const menu = document.getElementById('menuDropdown');
            menu.classList.toggle('hidden');
        }

        function exportData() {
            toggleMenu();
            const dataStr = JSON.stringify(restaurants, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `nyc-restaurants-backup-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            alert('Data exported! Save this file as your backup.');
        }

        function importData(event) {
            toggleMenu();
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const imported = JSON.parse(e.target.result);
                    if (!Array.isArray(imported)) {
                        alert('Invalid file format');
                        return;
                    }
                    
                    const confirmMsg = `This will import ${imported.length} restaurants. Current data (${restaurants.length} restaurants) will be replaced. Continue?`;
                    if (confirm(confirmMsg)) {
                        restaurants = imported;
                        saveToStorage();
                        renderRestaurants();
                        updateFilterOptions();
                        alert(`Successfully imported ${imported.length} restaurants!`);
                    }
                } catch (error) {
                    alert('Error reading file. Please make sure it\'s a valid backup file.');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        // Close menu when clicking outside
        document.addEventListener('click', function(event) {
            const menu = document.getElementById('menuDropdown');
            const menuButton = event.target.closest('.btn-menu');
            if (!menuButton && !menu.contains(event.target)) {
                menu.classList.add('hidden');
            }
        });

        // Initialize on load
        init();
    </script>
</body>
</html>
